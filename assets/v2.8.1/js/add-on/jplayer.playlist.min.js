!function(e,t){jPlayerPlaylist=function(t,n,r){var i=this;this.current=0,this.loop=!1,this.shuffled=!1,this.removing=!1,this.cssSelector=e.extend({},this._cssSelector,t),this.options=e.extend(!0,{keyBindings:{next:{key:39,fn:function(){i.next()}},previous:{key:37,fn:function(){i.previous()}}},stateClass:{shuffled:"s3-state-shuffled"}},this._options,r),this.playlist=[],this.original=[],this._initPlaylist(n),this.cssSelector.details=this.cssSelector.cssSelectorAncestor+" .s3-details",this.cssSelector.playlist=this.cssSelector.cssSelectorAncestor+" .s3-playlist",this.cssSelector.next=this.cssSelector.cssSelectorAncestor+" .s3-next",this.cssSelector.previous=this.cssSelector.cssSelectorAncestor+" .s3-previous",this.cssSelector.shuffle=this.cssSelector.cssSelectorAncestor+" .s3-shuffle",this.cssSelector.shuffleOff=this.cssSelector.cssSelectorAncestor+" .s3-shuffle-off",this.options.cssSelectorAncestor=this.cssSelector.cssSelectorAncestor,this.options.repeat=function(e){i.loop=e.jPlayer.options.loop},e(this.cssSelector.jPlayer).bind(e.jPlayer.event.ready,function(){i._init()}),e(this.cssSelector.jPlayer).bind(e.jPlayer.event.ended,function(){i.next()}),e(this.cssSelector.jPlayer).bind(e.jPlayer.event.play,function(){e(this).jPlayer("pauseOthers")}),e(this.cssSelector.jPlayer).bind(e.jPlayer.event.resize,function(t){t.jPlayer.options.fullScreen?e(i.cssSelector.details).show():e(i.cssSelector.details).hide()}),e(this.cssSelector.previous).click(function(e){e.preventDefault(),i.previous(),i.blur(this)}),e(this.cssSelector.next).click(function(e){e.preventDefault(),i.next(),i.blur(this)}),e(this.cssSelector.shuffle).click(function(t){t.preventDefault(),i.shuffle(i.shuffled&&e(i.cssSelector.jPlayer).jPlayer("option","useStateClassSkin")?!1:!0),i.blur(this)}),e(this.cssSelector.shuffleOff).click(function(e){e.preventDefault(),i.shuffle(!1),i.blur(this)}).hide(),this.options.fullScreen||e(this.cssSelector.details).hide(),e(this.cssSelector.playlist+" ul").empty(),this._createItemHandlers(),e(this.cssSelector.jPlayer).jPlayer(this.options)},jPlayerPlaylist.prototype={_cssSelector:{jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},_options:{playlistOptions:{autoPlay:!1,loopOnPrevious:!1,shuffleOnLoop:!0,enableRemoveControls:!1,displayTime:"slow",download:false,playerWidth:600,addTime:"fast",removeTime:"fast",shuffleTime:"slow",itemClass:"s3-playlist-item",freeGroupClass:"s3-free-media",freeItemClass:"s3-playlist-item-free",removeItemClass:"s3-playlist-item-remove"}},option:function(e,n){if(n===t)return this.options.playlistOptions[e];switch(this.options.playlistOptions[e]=n,e){case"enableRemoveControls":this._updateControls();break;case"itemClass":case"freeGroupClass":case"freeItemClass":case"removeItemClass":this._refresh(!0),this._createItemHandlers()}return this},_init:function(){var e=this;this._refresh(function(){e.options.playlistOptions.autoPlay?e.play(e.current):e.select(e.current)})},_initPlaylist:function(t){this.current=0,this.shuffled=!1,this.removing=!1,this.original=e.extend(!0,[],t),this._originalPlaylist()},_originalPlaylist:function(){var t=this;this.playlist=[],e.each(this.original,function(e){t.playlist[e]=t.original[e]})},_refresh:function(t){var n=this;if(t&&!e.isFunction(t))e(this.cssSelector.playlist+" ul").empty(),e.each(this.playlist,function(t){e(n.cssSelector.playlist+" ul").append(n._createListItem(n.playlist[t]))}),this._updateControls();else{var r=e(this.cssSelector.playlist+" ul").children().length?this.options.playlistOptions.displayTime:0;e(this.cssSelector.playlist+" ul").slideUp(r,function(){var r=e(this);e(this).empty(),e.each(n.playlist,function(e){r.append(n._createListItem(n.playlist[e]))}),n._updateControls(),e.isFunction(t)&&t(),n.playlist.length?e(this).slideDown(n.options.playlistOptions.displayTime):e(this).show()})}},_createListItem:function(t){var n=this,r="<li><div>";if(r+="<a href='javascript:;' class='"+this.options.playlistOptions.removeItemClass+"'>&times;</a>",t.free){var i=!0;r+="<span class='"+this.options.playlistOptions.freeGroupClass+"'>(",e.each(t,function(t,s){e.jPlayer.prototype.format[t]&&(i?i=!1:r+=" | ",r+="<a class='"+n.options.playlistOptions.freeItemClass+"' href='"+s+"' tabindex='-1'>"+t+"</a>")}),r+=")</span>"}var s=null;if(this.options.playlistOptions.share&&this.options.playlistOptions.download===false){s="5px"}var o=t.title.replace(/-/gi," ").replace(/_/gi," ").replace(/PROCESSED/g,"");r+="<a href='javascript:;' class='"+this.options.playlistOptions.itemClass+"' tabindex='0'>"+t.title+(t.artist?" <span class='s3-artist'>by "+t.artist+"</span>":"")+"</a>";r+="</div>"+(this.options.playlistOptions.share?'<a style="right:'+s+'" class="s3bubble_share" target="_blank" href="'+t.key+'"><i class="s3icon-twitter"></i></a>':"")+""+(this.options.playlistOptions.download?'<a class="download" target="_self" href="'+t.download+'" title="'+o+'"><i class="icon-cloud-download"></i></a>':"");r+="</li>";return r},_createItemHandlers:function(){var t=this;e(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.itemClass).on("click","a."+this.options.playlistOptions.itemClass,function(n){n.preventDefault();var r=e(this).parent().parent().index();t.current!==r?t.play(r):e(t.cssSelector.jPlayer).jPlayer("play"),t.blur(this)}),e(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.freeItemClass).on("click","a."+this.options.playlistOptions.freeItemClass,function(n){n.preventDefault(),e(this).parent().parent().find("."+t.options.playlistOptions.itemClass).click(),t.blur(this)}),e(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.removeItemClass).on("click","a."+this.options.playlistOptions.removeItemClass,function(n){n.preventDefault();var r=e(this).parent().parent().index();t.remove(r),t.blur(this)})},_updateControls:function(){this.options.playlistOptions.enableRemoveControls?e(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).show():e(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).hide(),this.shuffled?e(this.cssSelector.jPlayer).jPlayer("addStateClass","shuffled"):e(this.cssSelector.jPlayer).jPlayer("removeStateClass","shuffled"),e(this.cssSelector.shuffle).length&&e(this.cssSelector.shuffleOff).length&&(this.shuffled?(e(this.cssSelector.shuffleOff).show(),e(this.cssSelector.shuffle).hide()):(e(this.cssSelector.shuffleOff).hide(),e(this.cssSelector.shuffle).show()))},_highlight:function(n){this.playlist.length&&n!==t&&(e(this.cssSelector.playlist+" .s3-playlist-current").removeClass("s3-playlist-current"),e(this.cssSelector.playlist+" li:nth-child("+(n+1)+")").addClass("s3-playlist-current").find(".s3-playlist-item").addClass("s3-playlist-current"));e(".s3-playlist").animate({scrollTop:n*30},500)},setPlaylist:function(e){this._initPlaylist(e),this._init()},add:function(t,n){e(this.cssSelector.playlist+" ul").append(this._createListItem(t)).find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),this.original.push(t),this.playlist.push(t),n?this.play(this.playlist.length-1):1===this.original.length&&this.select(0)},remove:function(n){var r=this;return n===t?(this._initPlaylist([]),this._refresh(function(){e(r.cssSelector.jPlayer).jPlayer("clearMedia")}),!0):this.removing?!1:(n=0>n?r.original.length+n:n,n>=0&&n<this.playlist.length&&(this.removing=!0,e(this.cssSelector.playlist+" li:nth-child("+(n+1)+")").slideUp(this.options.playlistOptions.removeTime,function(){if(e(this).remove(),r.shuffled){var t=r.playlist[n];e.each(r.original,function(e){return r.original[e]===t?(r.original.splice(e,1),!1):void 0}),r.playlist.splice(n,1)}else r.original.splice(n,1),r.playlist.splice(n,1);r.original.length?n===r.current?(r.current=n<r.original.length?r.current:r.original.length-1,r.select(r.current)):n<r.current&&r.current--:(e(r.cssSelector.jPlayer).jPlayer("clearMedia"),r.current=0,r.shuffled=!1,r._updateControls()),r.removing=!1})),!0)},select:function(t){t=0>t?this.original.length+t:t,t>=0&&t<this.playlist.length?(this.current=t,this._highlight(t),e(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current])):this.current=0},play:function(n){n=0>n?this.original.length+n:n,n>=0&&n<this.playlist.length?this.playlist.length&&(this.select(n),e(this.cssSelector.jPlayer).jPlayer("play")):n===t&&e(this.cssSelector.jPlayer).jPlayer("play")},pause:function(){e(this.cssSelector.jPlayer).jPlayer("pause")},next:function(){var e=this.current+1<this.playlist.length?this.current+1:0;this.loop?0===e&&this.shuffled&&this.options.playlistOptions.shuffleOnLoop&&this.playlist.length>1?this.shuffle(!0,!0):this.play(e):e>0&&this.play(e)},previous:function(){var e=this.current-1>=0?this.current-1:this.playlist.length-1;(this.loop&&this.options.playlistOptions.loopOnPrevious||e<this.playlist.length-1)&&this.play(e)},shuffle:function(n,r){var i=this;n===t&&(n=!this.shuffled),(n||n!==this.shuffled)&&e(this.cssSelector.playlist+" ul").slideUp(this.options.playlistOptions.shuffleTime,function(){i.shuffled=n,n?i.playlist.sort(function(){return.5-Math.random()}):i._originalPlaylist(),i._refresh(!0),r||!e(i.cssSelector.jPlayer).data("jPlayer").status.paused?i.play(0):i.select(0),e(this).slideDown(i.options.playlistOptions.shuffleTime)})},blur:function(t){e(this.cssSelector.jPlayer).jPlayer("option","autoBlur")&&e(t).blur()}}}(jQuery)